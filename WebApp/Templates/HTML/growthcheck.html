<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WHO Child Growth Standards</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f7fa;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 1200px;
      margin: auto;
      padding: 20px;
    }

    .main-content {
      display: flex;
      flex-direction: row;
      gap: 20px;
      align-items: flex-start;
      flex-wrap: wrap;
    }

    .form-box {
      flex: 1 1 350px;
      max-width: 400px;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .chart-box {
      flex: 2;
      min-width: 400px;
    }

    h1, h2 {
      color: #2c3e50;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #34495e;
    }

    select, input {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 2px solid #e1e8ed;
      font-size: 16px;
    }

    button {
      margin-top: 20px;
      padding: 15px;
      width: 100%;
      background: linear-gradient(135deg, #3498db, #2980b9);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
    }

    .result, .info {
      margin-top: 25px;
      padding: 20px;
      background: #ffffff;
      border-left: 5px solid #27ae60;
      border-radius: 8px;
    }

    .metric {
      margin: 15px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 6px;
      border: 1px solid #e9ecef;
    }

    .normal { border-left: 4px solid #27ae60; }
    .below-normal { border-left: 4px solid #f39c12; }
    .severely-below { border-left: 4px solid #e74c3c; }
    .above-normal { border-left: 4px solid #9b59b6; }

    canvas {
      width: 100% !important;
      height: auto !important;
      background: white;
      border: 8px solid #d63384;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin-top: 20px;
    }

    @media (max-width: 768px) {
      .main-content {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 style="text-align: center;">WHO Child Growth Standards Checker</h1>
    <div class="main-content">
      <div class="form-box">
        <div class="form-group">
          <label for="sex">Sex:</label>
          <select id="sex">
            <option value="female">Female</option>
            <option value="male">Male</option>
          </select>
        </div>
        <div class="form-group">
          <label for="age">Age (months):</label>
          <input type="number" id="age" min="0" max="24" placeholder="Enter age in months (0-24)">
        </div>
        <div class="form-group">
          <label for="weight">Weight (kg):</label>
          <input type="number" id="weight" step="0.1" placeholder="Enter weight in kilograms">
        </div>
        <div class="form-group">
          <label for="height">Height/Length (cm):</label>
          <input type="number" id="height" step="0.1" placeholder="Enter height in centimeters">
        </div>
        <button onclick="checkGrowth()">Check Growth Standards</button>
        <div class="result" id="resultBox" style="display: none;"></div>
        <div class="info">
          <strong>About Z-scores:</strong><br>
          • Normal: Z-score between -2 and +2<br>
          • Below Normal: Z-score between -3 and -2<br>
          • Severely Below Normal: Z-score below -3<br>
          • Above Normal: Z-score above +2<br><br>
          <em>Based on WHO Child Growth Standards (2006)</em>
        </div>
      </div>

      <div class="chart-box">
        <h2>Weight-for-Age Chart (0–2 Years)</h2>
        <canvas id="growthChart"></canvas>
        <h2>Height-for-Age Chart (0–2 Years)</h2>
        <canvas id="heightChart"></canvas>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const labels = Array.from({ length: 25 }, (_, i) => i);
    const childWeightProgress = new Array(25).fill(null);
    const childHeightProgress = new Array(25).fill(null);

    const weightChart = new Chart(document.getElementById('growthChart').getContext('2d'), {
      type: 'line',
      data: {
        labels,
        datasets: [
          {
            label: 'Obese (+3)',
            data: [null],
            borderColor: '#8b0000',
            backgroundColor: '#8b0000',
            pointRadius: 0,
            tension: 0.3,
            borderWidth: 0,
            fill: false
          },
          {
            label: 'Overweight (+2)',
            data: [null],
            borderColor: '#ff6b35',
            backgroundColor: '#ff6b35',
            pointRadius: 0,
            tension: 0.3,
            borderWidth: 0,
            fill: false
          },
          {
            label: 'Normal (0)',
            data: [null],
            borderColor: '#27ae60',
            backgroundColor: '#27ae60',
            pointRadius: 0,
            tension: 0.3,
            borderWidth: 0,
            fill: false
          },
          {
            label: 'Underweight (-2)',
            data: [null],
            borderColor: '#f39c12',
            backgroundColor: '#f39c12',
            pointRadius: 0,
            tension: 0.3,
            borderWidth: 0,
            fill: false
          },
          {
            label: 'Wasted (-3)',
            data: [null],
            borderColor: '#e74c3c',
            backgroundColor: '#e74c3c',
            pointRadius: 0,
            tension: 0.3,
            borderWidth: 0,
            fill: false
          },
          {
            label: 'Your Child',
            data: [],
            borderColor: '#d63384',
            backgroundColor: '#d63384',
            pointRadius: 0,
            pointHoverRadius: 0,
            tension: 0.3,
            borderWidth: 3,
            fill: false
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          x: {
            title: { display: true, text: 'Age (months)' },
            ticks: {
              callback: val => val === 0 ? 'Birth' : val === 12 ? '1 year' : val === 24 ? '2 years' : val
            }
          },
          y: {
            title: { display: true, text: 'Weight (kg)' },
            min: 1,
            max: 17
          }
        },
        plugins: {
          legend: { position: 'right' }
        }
      }
    });

    const heightChart = new Chart(document.getElementById('heightChart').getContext('2d'), {
      type: 'line',
      data: {
        labels,
        datasets: [
          {
            label: 'Obese (+3)',
            data: [null],
            borderColor: '#8b0000',
            backgroundColor: '#8b0000',
            pointRadius: 0,
            tension: 0.3,
            borderWidth: 0,
            fill: false
          },
          {
            label: 'Overweight (+2)',
            data: [null],
            borderColor: '#ff6b35',
            backgroundColor: '#ff6b35',
            pointRadius: 0,
            tension: 0.3,
            borderWidth: 0,
            fill: false
          },
          {
            label: 'Normal (0)',
            data: [null],
            borderColor: '#27ae60',
            backgroundColor: '#27ae60',
            pointRadius: 0,
            tension: 0.3,
            borderWidth: 0,
            fill: false
          },
          {
            label: 'Underweight (-2)',
            data: [null],
            borderColor: '#f39c12',
            backgroundColor: '#f39c12',
            pointRadius: 0,
            tension: 0.3,
            borderWidth: 0,
            fill: false
          },
          {
            label: 'Wasted (-3)',
            data: [null],
            borderColor: '#e74c3c',
            backgroundColor: '#e74c3c',
            pointRadius: 0,
            tension: 0.3,
            borderWidth: 0,
            fill: false
          },
          {
            label: 'Your Child',
            data: [],
            borderColor: '#d63384',
            backgroundColor: '#d63384',
            pointRadius: 0,
            pointHoverRadius: 0,
            tension: 0.3,
            borderWidth: 3,
            fill: false
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          x: {
            title: { display: true, text: 'Age (months)' },
            ticks: {
              callback: val => val === 0 ? 'Birth' : val === 12 ? '1 year' : val === 24 ? '2 years' : val
            }
          },
          y: {
            title: { display: true, text: 'Height (cm)' },
            min: 45,
            max: 100
          }
        },
        plugins: {
          legend: { position: 'right' }
        }
      }
    });

    function calculateZScore(value, mean, sd) {
      return (value - mean) / sd;
    }

    function interpretZScore(z) {
      if (z >= 3) return { status: "Obese", class: "severely-below", legend: 0 };
      else if (z >= 2) return { status: "Overweight", class: "above-normal", legend: 1 };
      else if (z >= -2) return { status: "Normal", class: "normal", legend: 2 };
      else if (z >= -3) return { status: "Underweight", class: "below-normal", legend: 3 };
      else return { status: "Wasted", class: "severely-below", legend: 4 };
    }

    function updateLegendHighlight(chart, activeIndex) {
      // Get the color for the active status
      const statusColors = ['#8b0000', '#ff6b35', '#27ae60', '#f39c12', '#e74c3c'];
      const activeColor = statusColors[activeIndex];
      
      // Update the "Your Child" line color to match the status
      chart.data.datasets[5].borderColor = activeColor;
      chart.data.datasets[5].backgroundColor = activeColor;
      
      chart.update();
    }

    function getPercentile(z) {
      const percentile = 50 + (z * 16.5);
      return Math.max(0.1, Math.min(99.9, percentile));
    }

    function checkGrowth() {
      const sex = document.getElementById("sex").value;
      const age = parseInt(document.getElementById("age").value);
      const weight = parseFloat(document.getElementById("weight").value);
      const height = parseFloat(document.getElementById("height").value);
      const resultBox = document.getElementById("resultBox");

      if (isNaN(age) || age < 0 || age > 24 || isNaN(weight) || isNaN(height) || weight <= 0 || height <= 0) {
        resultBox.innerHTML = `<div class="severely-below">Please provide valid inputs for age (0–24), weight, and height.</div>`;
        resultBox.style.display = 'block';
        return;
      }

      const meanWeight = 8 + age * 0.3;
      const sdWeight = 1.0;
      const meanHeight = 70 + age * 0.5;
      const sdHeight = 2.0;

      const weightZ = calculateZScore(weight, meanWeight, sdWeight);
      const heightZ = calculateZScore(height, meanHeight, sdHeight);

      const weightInterp = interpretZScore(weightZ);
      const heightInterp = interpretZScore(heightZ);

      resultBox.innerHTML = `
        <h3>Results</h3>
        <div class="metric ${weightInterp.class}">
          <strong>Weight-for-Age:</strong> ${weight} kg<br>
          Z-score: ${weightZ.toFixed(2)}<br>
          Status: ${weightInterp.status}<br>
          Percentile: ${getPercentile(weightZ).toFixed(1)}th
        </div>
        <div class="metric ${heightInterp.class}">
          <strong>Height-for-Age:</strong> ${height} cm<br>
          Z-score: ${heightZ.toFixed(2)}<br>
          Status: ${heightInterp.status}<br>
          Percentile: ${getPercentile(heightZ).toFixed(1)}th
        </div>
      `;
      resultBox.style.display = 'block';

      // Update legend highlighting based on weight status
      updateLegendHighlight(weightChart, weightInterp.legend);
      updateLegendHighlight(heightChart, heightInterp.legend);

      childWeightProgress[age] = weight;
      childHeightProgress[age] = height;

      if (childWeightProgress[0] == null) {
        const firstWeight = childWeightProgress.find(w => w !== null);
        if (firstWeight != null) childWeightProgress[0] = firstWeight;
      }

      if (childHeightProgress[0] == null) {
        const firstHeight = childHeightProgress.find(h => h !== null);
        if (firstHeight != null) childHeightProgress[0] = firstHeight;
      }

      weightChart.data.datasets[5].data = childWeightProgress
        .map((w, i) => (w != null ? { x: i, y: w } : null))
        .filter(p => p !== null);

      heightChart.data.datasets[5].data = childHeightProgress
        .map((h, i) => (h != null ? { x: i, y: h } : null))
        .filter(p => p !== null);

      weightChart.update();
      heightChart.update();
    }
  </script>
</body>
</html>