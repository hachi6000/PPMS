<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Change Password - PPMS</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

    :root {
      --primary-color: #007bff;
      --primary-hover: #0056b3;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --warning-color: #ffc107;
      --light-gray: #f8f9fa;
      --medium-gray: #6c757d;
      --dark-gray: #343a40;
      --border-color: #dee2e6;
      --shadow-light: 0 2px 10px rgba(0,0,0,0.1);
      --shadow-medium: 0 4px 20px rgba(0,0,0,0.15);
      --border-radius: 12px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
      background: white;
      background-color: white;
      background-image: none;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .main-container {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-medium);
      padding: 40px;
      width: 100%;
      max-width: 450px;
      position: relative;
      overflow: hidden;
      border: 1px solid var(--border-color);
    }

    .main-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-color), var(--success-color));
    }

    .header {
      text-align: center;
      margin-bottom: 35px;
    }

    .header h2 {
      font-size: 28px;
      font-weight: 600;
      color: var(--dark-gray);
      margin-bottom: 8px;
    }

    .header p {
      color: var(--medium-gray);
      font-size: 14px;
      font-weight: 400;
    }

    .form-group {
      margin-bottom: 24px;
      position: relative;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--dark-gray);
      font-size: 14px;
    }

    .input-wrapper {
      position: relative;
    }

    .form-input {
      width: 100%;
      padding: 14px 50px 14px 16px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      font-size: 15px;
      font-family: inherit;
      transition: var(--transition);
      background: white;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
    }

    .form-input.error {
      border-color: var(--danger-color);
    }

    .form-input.success {
      border-color: var(--success-color);
    }

    .toggle-password {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: var(--medium-gray);
      font-size: 18px;
      transition: var(--transition);
      padding: 4px;
    }

    .toggle-password:hover {
      color: var(--primary-color);
    }

    .password-strength {
      margin-top: 8px;
      font-size: 12px;
    }

    .strength-bar {
      height: 4px;
      background: var(--border-color);
      border-radius: 2px;
      margin: 6px 0;
      overflow: hidden;
    }

    .strength-fill {
      height: 100%;
      width: 0%;
      transition: var(--transition);
      border-radius: 2px;
    }

    .strength-weak .strength-fill { background: var(--danger-color); width: 25%; }
    .strength-fair .strength-fill { background: var(--warning-color); width: 50%; }
    .strength-good .strength-fill { background: var(--primary-color); width: 75%; }
    .strength-strong .strength-fill { background: var(--success-color); width: 100%; }

    .password-requirements {
      margin-top: 12px;
      font-size: 12px;
    }

    .requirement {
      display: flex;
      align-items: center;
      margin: 4px 0;
      color: var(--medium-gray);
      transition: var(--transition);
    }

    .requirement.met {
      color: var(--success-color);
    }

    .requirement i {
      width: 16px;
      margin-right: 8px;
      font-size: 10px;
    }

    .error-message {
      margin-top: 6px;
      color: var(--danger-color);
      font-size: 12px;
      display: none;
    }

    .submit-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      margin-top: 20px;
    }

    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 123, 255, 0.3);
    }

    .submit-btn:disabled {
      background: var(--medium-gray);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .submit-btn .loading-spinner {
      display: none;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      animation: modalFadeIn 0.3s ease-out;
    }

    @keyframes modalFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      display: flex;
      flex-direction: column;
      background: white;
      margin: 5% auto;
      padding: 0;
      width: 90%;
      max-width: 600px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-medium);
      animation: modalSlideIn 0.3s ease-out;
      max-height: 85vh; /* prevent overflow off-screen */
    }

    @keyframes modalSlideIn {
      from { opacity: 0; transform: translateY(-50px) scale(0.9); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .modal-header {
      padding: 24px 30px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--light-gray);
    }

    .modal-header h3 {
      font-size: 20px;
      font-weight: 600;
      color: var(--dark-gray);
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--medium-gray);
      padding: 4px;
      border-radius: 4px;
      transition: var(--transition);
    }

    .close-btn:hover {
      background: rgba(0,0,0,0.1);
      color: var(--dark-gray);
    }

    .modal-body {
      flex: 1;                  /* takes remaining space */
      padding: 30px;
      overflow-y: auto;         /* scroll only here */
      line-height: 1.6;
    }

    .modal-body h3 {
      color: var(--dark-gray);
      margin: 20px 0 10px 0;
      font-size: 16px;
      font-weight: 600;
    }

    .modal-body h4 {
      color: var(--dark-gray);
      margin: 16px 0 8px 0;
      font-size: 14px;
      font-weight: 600;
    }

    .modal-body p {
      margin-bottom: 15px;
      color: var(--dark-gray);
      font-size: 14px;
    }

    .modal-body ul {
      margin: 10px 0 15px 20px;
      color: var(--dark-gray);
    }

    .modal-body li {
      margin-bottom: 5px;
      font-size: 14px;
    }

    .checkbox-container {
      display: flex;
      align-items: flex-start;
      margin: 20px 0;
      padding: 16px;
      background: var(--light-gray);
      border-radius: 8px;
    }

    .checkbox-container input[type="checkbox"] {
      margin-right: 12px;
      margin-top: 2px;
      transform: scale(1.2);
    }

    .checkbox-container label {
      font-size: 14px;
      color: var(--dark-gray);
      cursor: pointer;
    }

    .policy-link {
      color: var(--primary-color);
      text-decoration: underline;
      cursor: pointer;
      transition: var(--transition);
    }

    .policy-link:hover {
      color: var(--primary-hover);
    }

    .modal-footer {
      padding: 20px 30px;
      border-top: 1px solid var(--border-color);
      background: var(--light-gray);
      text-align: right;
      position: sticky;
      bottom: 0;               /* stays visible */
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .modal-footer {
        text-align: center; /* Center the button on smaller screens */
      }

      .modal-btn {
        width: 100%;       /* Full width button */
        padding: 14px;     /* Make it slightly taller for touch screens */
        font-size: 16px;
      }
    }

    @media (max-width: 480px) {
      .modal-btn {
        font-size: 15px;
        padding: 12px;
      }
    }

    .modal-btn {
      padding: 10px 24px;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: var(--transition);
    }

    .modal-btn:hover {
      background: var(--primary-hover);
    }

    .modal-btn:disabled {
      background: var(--medium-gray);
      cursor: not-allowed;
    }

    /* Responsive Design */
    @media (max-width: 480px) {
      .main-container {
        padding: 30px 20px;
        margin: 10px;
      }

      .header h2 {
        font-size: 24px;
      }

      .modal-content {
        margin: 5% auto; /* Keep margin even on small screens */
        width: 95%;
      }

      .modal-body {
        padding: 20px;
      }
    }
</style>

</head>
<body>
  <div class="main-container">
    <div class="header">
      <h2>Change Password</h2>
      <p>Please enter your new password below</p>
    </div>

    <form id="passwordForm" method="POST" action="{% url 'change_password_first' %}">
      {% csrf_token %}
      <div class="form-group">
        <label for="new_password">New Password</label>
        <div class="input-wrapper">
          <input type="password" id="new_password" name="new_password" class="form-input" required autocomplete="new-password">
          <i class="fa-solid fa-eye toggle-password" onclick="togglePassword('new_password', this)" title="Show/Hide Password"></i>
        </div>
        <div class="password-strength">
          <div class="strength-bar">
            <div class="strength-fill"></div>
          </div>
          <span class="strength-text">Password strength: <strong>Enter password</strong></span>
        </div>
        <div class="password-requirements">
          <div class="requirement" id="req-length">
            <i class="fa-solid fa-circle"></i>
            <span>At least 8 characters</span>
          </div>
          <div class="requirement" id="req-uppercase">
            <i class="fa-solid fa-circle"></i>
            <span>One uppercase letter</span>
          </div>
          <div class="requirement" id="req-lowercase">
            <i class="fa-solid fa-circle"></i>
            <span>One lowercase letter</span>
          </div>
          <div class="requirement" id="req-number">
            <i class="fa-solid fa-circle"></i>
            <span>One number</span>
          </div>
        </div>
        <div class="error-message" id="password-error"></div>
      </div>

      <div class="form-group">
        <label for="confirm_password">Confirm New Password</label>
        <div class="input-wrapper">
          <input type="password" id="confirm_password" name="confirm_password" class="form-input" required autocomplete="new-password">
          <i class="fa-solid fa-eye toggle-password" onclick="togglePassword('confirm_password', this)" title="Show/Hide Password"></i>
        </div>
        <div class="error-message" id="confirm-error"></div>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">
        <div class="loading-spinner"></div>
        <span>Update Password</span>
      </button>
    </form>
  </div>

  <!-- Terms and Conditions Modal -->
  <div id="termsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Terms and Conditions</h3>
        <button class="close-btn" onclick="closeModal('termsModal')">&times;</button>
      </div>
      <div class="modal-body">
        <p><strong>Preschooler Profiling and Monitoring System</strong></p>
        <p><strong>Last updated:</strong> July 29, 2025</p>

        <h3>1. Introduction</h3>
        <p>These Terms and Conditions constitute a legally binding agreement between you, whether personally or on behalf of an entity and the development team from Technological University of the Philippines - Cavite, concerning your access to and use of the Preschooler Profiling and Monitoring System.</p>
        <p>By accessing or using our System, you agree that you have read, understood, and agree to be bound by these Terms. If you do not agree with these Terms, you are prohibited from using or accessing this System.</p>

        <h3>2. Acceptance of Terms</h3>
        <p>By creating an account, accessing, or using the Preschooler Profiling and Monitoring System, you acknowledge that you have read and understood these Terms and agree to be bound by them. These Terms apply to all users of the system, including health workers, administrators, parents, and educators.</p>

        <h3>3. Description of Service</h3>
        <p>The Preschooler Profiling and Monitoring System is a web-based application designed to help preschool institutions, daycare centers, barangay health workers, and authorized personnel track, monitor, and assess the developmental progress of preschool-aged children (ages 0-60 months). The System provides tools for:</p>
        <ul>
          <li>Preschooler profile management</li>
          <li>Developmental milestone tracking and assessment</li>
          <li>Health and nutritional status monitoring</li>
          <li>Early childhood development progress tracking</li>
          <li>Communication between educators, health workers, and parents/guardians</li>
          <li>Report generation and analytics for developmental assessments</li>
        </ul>

        <h3>4. User Eligibility and Account Registration</h3>
        <h4>4.1 Eligibility</h4>
        <p>You must be at least 18 years of age to use this System. By using the System, you represent and warrant that you meet this age requirement.</p>

        <h4>4.2 Account Registration</h4>
        <p>To access certain features of the System, you must register for an account. You agree to:</p>
        <ul>
          <li>Provide accurate, current, and complete information during registration</li>
          <li>Maintain and promptly update your account information</li>
          <li>Maintain the security and confidentiality of your login credentials</li>
          <li>Accept responsibility for all activities that occur under your account</li>
        </ul>

        <h4>4.3 Account Types</h4>
        <ul>
          <li>Health administrators</li>
          <li>Barangay health workers and community health personnel</li>
          <li>Parents and guardians (with appropriate authorization)</li>
        </ul>

        <h3>5. Acceptable Use Policy</h3>
        <h4>5.1 Permitted Uses</h4>
        <p>You may use the System only for lawful purposes and in accordance with these Terms. Specifically, you agree to use the System only for:</p>
        <ul>
          <li>Early childhood development and health assessment purposes</li>
          <li>Authorized monitoring of preschooler developmental progress</li>
          <li>Health and nutritional status tracking by qualified personnel</li>
          <li>Communication with authorized parties regarding child development and health</li>
          <li>Administrative tasks related to preschool institutions and community health programs</li>
        </ul>

        <h4>5.2 Prohibited Uses</h4>
        <p>You agree NOT to use the System:</p>
        <ul>
          <li>For any unlawful purpose or to solicit others to perform unlawful acts</li>
          <li>To violate any international, federal, provincial, or state regulations, rules, laws, or local ordinances</li>
          <li>To infringe upon or violate our intellectual property rights or the intellectual property rights of others</li>
          <li>To harass, abuse, insult, harm, defame, slander, disparage, intimidate, or discriminate</li>
          <li>To submit false or misleading information about children or their development</li>
          <li>To access or attempt to access accounts or data belonging to other users without authorization</li>
          <li>To interfere with, disrupt, or create an undue burden on the System or networks connected to the System</li>
        </ul>

        <h3>16. Contact Information</h3>
        <p><strong>Thesis Development Team</strong><br>
        Technological University of the Philippines - Cavite<br>
        Email: ppms.cluster4imus@gmail.com<br>
        Address: Technological University of the Philippines - Cavite Campus, Cavite, Philippines</p>

        <p><em>By using the Preschooler Profiling and Monitoring System, you acknowledge that you have read and understood these Terms and Conditions and agree to be bound by them.</em></p>
      </div>
      <div class="checkbox-container">
        <input type="checkbox" id="agreePrivacy">
        <label for="agreePrivacy">I have read and agree to the <span class="policy-link" onclick="showModal('privacyModal')">Privacy Policy</span></label>
      </div>
      <div class="modal-footer">
        <button class="modal-btn" id="agreeBtn" onclick="submitIfAgreed()" disabled>I Agree</button>
      </div>
    </div>
  </div>

  <!-- Privacy Policy Modal -->
  <div id="privacyModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Privacy Policy</h3>
        <button class="close-btn" onclick="closeModal('privacyModal')">&times;</button>
      </div>
      <div class="modal-body">
        <p><strong>Effective Date:</strong> July 29, 2025</p>
        <p>This Privacy Policy explains how the Preschooler Profiling and Monitoring System (PPMS) collects, uses, and protects your personal data in compliance with the Data Privacy Act of 2012 (Republic Act No. 10173), COPPA, and other applicable laws.</p>

        <h3>1. Scope</h3>
        <p>This Policy applies to all users of the PPMS, including health workers, administrators, parents, and guardians.</p>

        <h3>2. Data We Collect</h3>
        <ul>
          <li><strong>Personal Information:</strong> Name, birthdate, address, contact details, parent/guardian information.</li>
          <li><strong>Sensitive Personal Information:</strong> Preschooler health records, developmental assessments, nutritional status, and other related health data.</li>
        </ul>

        <h3>3. Purpose of Data Processing</h3>
        <p>We collect and process data solely for the following purposes:</p>
        <ul>
          <li>Preschooler health monitoring and BMI assessment</li>
          <li>Developmental milestone and progress tracking</li>
          <li>Communication between health workers, educators, and parents</li>
          <li>Compliance with public health programs and reporting requirements</li>
        </ul>

        <h3>4. Legal Basis for Processing</h3>
        <p>Data processing is carried out based on:</p>
        <ul>
          <li>Your consent</li>
          <li>Legitimate interests of early childhood health monitoring</li>
          <li>Compliance with applicable laws and regulations</li>
        </ul>

        <h3>5. Data Sharing and Disclosure</h3>
        <p>Data will only be shared with:</p>
        <ul>
          <li>Authorized barangay health workers, administrators, and system personnel</li>
          <li>Government agencies (e.g., Department of Health) when legally required</li>
          <li>Researchers and academic partners, only with anonymized data</li>
        </ul>

        <h3>6. Data Retention</h3>
        <p>Data is retained only as long as necessary for its intended purpose or as required by law. Upon account termination, retention and deletion follow our Terms and Privacy Policy.</p>

        <h3>7. Children's Privacy</h3>
        <p>We strictly comply with COPPA and RA 10173 in handling preschooler data. No data is collected directly from children without parental or guardian authorization.</p>

        <h3>8. Your Rights</h3>
        <p>Under RA 10173, you have the right to:</p>
        <ul>
          <li>Access, update, or correct your data</li>
          <li>Request deletion or blocking of personal data</li>
          <li>Withdraw consent to data processing</li>
          <li>File a complaint with the National Privacy Commission (NPC)</li>
        </ul>

        <h3>9. Security Measures</h3>
        <p>We implement organizational, physical, and technical measures to protect personal data against unauthorized access, alteration, disclosure, or destruction.</p>

        <h3>10. Updates to this Policy</h3>
        <p>This Privacy Policy may be updated from time to time. Users will be notified of significant changes.</p>

        <h3>11. Contact Information</h3>
        <p><strong>Thesis Development Team</strong><br>
        Technological University of the Philippines - Cavite<br>
        Email: ppms.cluster4imus@gmail.com<br>
        Address: Technological University of the Philippines - Cavite Campus, Cavite, Philippines</p>
      </div>
    </div>
  </div>

  <script>
    // Password strength checker
    function checkPasswordStrength(password) {
      let score = 0;
      const requirements = {
        length: password.length >= 8,
        uppercase: /[A-Z]/.test(password),
        lowercase: /[a-z]/.test(password),
        number: /\d/.test(password)
      };

      // Update requirement indicators
      Object.keys(requirements).forEach(req => {
        const element = document.getElementById(`req-${req}`);
        const icon = element.querySelector('i');
        
        if (requirements[req]) {
          element.classList.add('met');
          icon.className = 'fa-solid fa-check';
          score++;
        } else {
          element.classList.remove('met');
          icon.className = 'fa-solid fa-circle';
        }
      });

      // Update strength bar and text
      const strengthBar = document.querySelector('.strength-bar');
      const strengthText = document.querySelector('.strength-text strong');
      
      strengthBar.className = 'strength-bar';
      
      if (score === 0) {
        strengthText.textContent = 'Enter password';
      } else if (score <= 1) {
        strengthBar.classList.add('strength-weak');
        strengthText.textContent = 'Weak';
      } else if (score <= 2) {
        strengthBar.classList.add('strength-fair');
        strengthText.textContent = 'Fair';
      } else if (score <= 3) {
        strengthBar.classList.add('strength-good');
        strengthText.textContent = 'Good';
      } else {
        strengthBar.classList.add('strength-strong');
        strengthText.textContent = 'Strong';
      }

      return score >= 3; // Require at least 3/4 criteria
    }

    // Password validation
    function validatePassword() {
      const newPassword = document.getElementById('new_password');
      const confirmPassword = document.getElementById('confirm_password');
      const passwordError = document.getElementById('password-error');
      const confirmError = document.getElementById('confirm-error');
      
      let isValid = true;

      // Check password strength
      const isStrong = checkPasswordStrength(newPassword.value);
      if (newPassword.value && !isStrong) {
        passwordError.textContent = 'Password must meet at least 3 of the 4 requirements';
        passwordError.style.display = 'block';
        newPassword.classList.add('error');
        newPassword.classList.remove('success');
        isValid = false;
      } else if (newPassword.value) {
        passwordError.style.display = 'none';
        newPassword.classList.remove('error');
        newPassword.classList.add('success');
      }

      // Check password match
      if (confirmPassword.value && newPassword.value !== confirmPassword.value) {
        confirmError.textContent = 'Passwords do not match';
        confirmError.style.display = 'block';
        confirmPassword.classList.add('error');
        confirmPassword.classList.remove('success');
        isValid = false;
      } else if (confirmPassword.value) {
        confirmError.style.display = 'none';
        confirmPassword.classList.remove('error');
        confirmPassword.classList.add('success');
      }

      return isValid;
    }

    // Toggle password visibility
    function togglePassword(inputId, icon) {
      const input = document.getElementById(inputId);
      const isPassword = input.type === 'password';
      
      input.type = isPassword ? 'text' : 'password';
      icon.className = isPassword ? 'fa-solid fa-eye-slash toggle-password' : 'fa-solid fa-eye toggle-password';
    }

    // Modal functions
    function showModal(modalId) {
      document.getElementById(modalId).style.display = 'block';
      document.body.style.overflow = 'hidden';
    }

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
      document.body.style.overflow = 'auto';
    }

    function submitIfAgreed() {
      const checkbox = document.getElementById('agreePrivacy');
      if (checkbox.checked) {
        closeModal('termsModal');
        
        // Simply submit the regular Django form
        const submitBtn = document.getElementById('submitBtn');
        const spinner = submitBtn.querySelector('.loading-spinner');
        const text = submitBtn.querySelector('span');
        
        submitBtn.disabled = true;
        spinner.style.display = 'inline-block';
        text.textContent = 'Updating Password...';
        
        // Submit the Django form normally
        document.getElementById('passwordForm').submit();
      } else {
        Swal.fire({
          icon: 'warning',
          title: 'Agreement Required',
          text: 'Please read and agree to the Privacy Policy to continue.',
          confirmButtonColor: '#007bff'
        });
      }
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
      const newPassword = document.getElementById('new_password');
      const confirmPassword = document.getElementById('confirm_password');
      const agreeCheckbox = document.getElementById('agreePrivacy');
      const agreeBtn = document.getElementById('agreeBtn');

      // Password validation on input
      newPassword.addEventListener('input', validatePassword);
      confirmPassword.addEventListener('input', validatePassword);

      // Enable/disable agree button based on checkbox
      agreeCheckbox.addEventListener('change', function() {
        agreeBtn.disabled = !this.checked;
      });

      // Form submission
      document.getElementById('passwordForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (validatePassword()) {
          showModal('termsModal');
        } else {
          Swal.fire({
            icon: 'error',
            title: 'Validation Error',
            text: 'Please fix the password issues before continuing.',
            confirmButtonColor: '#007bff'
          });
        }
      });

      // Close modals when clicking outside
      window.addEventListener('click', function(e) {
        if (e.target.classList.contains('modal')) {
          closeModal(e.target.id);
        }
      });

      // Escape key to close modals
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          const openModals = document.querySelectorAll('.modal[style*="block"]');
          openModals.forEach(modal => {
            closeModal(modal.id);
          });
        }
      });
    });
  </script>
</body>
</html> 